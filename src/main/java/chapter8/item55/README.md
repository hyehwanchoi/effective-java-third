# 옵셔널 반환은 신중히 하라

### 메서드가 값을 반환할 수 없을 때
* 자바 8 전에는 예외를 던지거나 null 을 반환
  * 예외는 진짜 예외적인 상황에서만 사용
  * 예외를 생성할 때 스택 추적 전체를 캡처하므로 비용도 비싸다.
* 자바 8 부터는 `Optional<T>` 를 사용한다.
  * 아무것도 반환하지 않아야 할 때는 `Optional<T>` 반환하도록 선언한다.
  * 보통은 T 를 반환한다.
####
  
* 옵셔널을 반환하는 메서드에서는 절대 null 을 반환하지 말자.
  * `Optional.of(value)` 에 null 을 넣으면 null 예외 처리한다.

### 클라이언트가 값을 받지 못했을 경우 대비
* 기본값을 설정한다.
  * `orElse`
* 상황에 맞는 예외를 던진다.
  * 예외가 실제로 발생하지 않는 한 예외 생성 비용은 들지 않는다.
  * `orElseThrow`
* 항상 값이 있다고 가정한다.
  * `orElseGet`
####

* isPresent : 옵셔널이 채워져 있으면 true, 비어있으면 false 를 반환한다.
####
    // 자바 8
    streamOfOptionals.filter(Optional::isPresent)
      .map(Optional::get)

    // 자바 9
    // Optional 의 stream() 메서드가 추가됨.
    // 옵셔널에 값이 있으면 그 값을 원소로 담은 스트림으로, 값이 없다면 빈스트림으로 변환한다.
    streamOfOptinals.flatMap(Optional::stream)

### 옵셔널 사용의 주의점
* 컬렉션, 스트림, 배열, 옵셔널 같은 컨테이너 타입은 옵셔널로 감싸면 안 된다.
  * 빈 List<T>T 를 반환하는 게 좋다.
  * 빈 컨테이너를 반환하면 클라이언트에 옵셔널 처리 코드를 넣지 않아도 된다.
* 옵셔널을 맵의 값으로 사용하면 절대 안된다.
  * 옵셔널을 컬렉션의 키, 값, 원소나 배열의 원소로 사용하는 게 적절한 상황은 거의 없다.

### 메서드 반환 타입이 Optional<T> 인 경우
* 결과가 없을 수 있으며, 클라이언트가 이 상황을 특별하게 처리해야 한다면 `Optional<T>` 를 반환한다.
  * 단, 성능이 중요한 상황인 경우 맞지 않을 수 있음.
  * 박싱된 기본 타입을 담은 옵셔널을 반환하는 일은 없도록 해야 한다.
    * 단, 덜 중요한 기본 타입인 Boolean, Byte, Character, Short, Float 예외

### 옵셔널을 인스턴스 필드에 저장해두는 게 필요할 때
* `아이템 2`의 NutritionFacts 인스턴스의 필드 중 상당수는 필수가 아니다.
* 또한 그 필드들은 기본 타입이라 값이 없음을 나타낼 방법이 없다.
* 이런 NutritionFacts 라면 선택적 필드의 게터 메서드들이 옵셔널을 반환하게 해주면 좋다.

### 정리
* 성능에 민감하다면 null 을 반환하거나 예외를 던지자.