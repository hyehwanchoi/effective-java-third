# 스트림 병렬화는 주의해서 적용하라

### 병렬화 주의점
* 동시성 프로그래밍을 할 때는 안정성과 응답 가능 상태를 유지해야 한다.
* 데이터 소스가 Stream.iterate 거나 중간 연산으로 limit 를 쓰면 파이프라인 병렬화로는 성능 개선을 할 수 없다.
* 직접 구현한 Stream, Iterable, Collection 이 병렬화의 이점을 제대로 누리게 하고 싶다면 spliterator 메서드를
  반드시 재정의하고 결과 스트림의 병렬화 성능을 강도 높게 테스트하라.
* 스트림을 잘못 병렬화하면 성능이 나빠질 뿐만 아니라 결과 자체가 잘못되거나 예상 못한 동작이 발생할 수 있다.

### 병렬화를 언제 사용하나 ?
* ArrayList, HashMap, HashSet, ConcurrentHashMap 의 인스턴스
* 배열, int 범위, long 범위일 때

### 위의 자료구조들의 공통점
* 원소들을 순차적으로 실행할 때의 참조 지역성이 뛰어나다.

### 참조 지역성
* 참조 지역성이 낮으면 스레드는 데이터가 주 메모리에서 캐시 메모리로 전송되어 오기를 기다린다.
* 참조 지역성은 다량의 데이터를 처리하는 벌크 연산을 병렬화할 떄 아주 중요한 요소로 작용한다.

### 정리
* 스트림의 병렬화는 오직 성능 최적화의 수단이다.
* 모니터링 후 개선의 효과가 확실해졌을 때만 병렬화 버전 코드를 운영에 반영하라.

### 용어
* 참조 지역성 : 이웃한 원소의 참조들이 메모리에 연속해서 저장되어 있다는 뜻
* 안전 실패 : 결과가 잘못되거나 오동작하는 것