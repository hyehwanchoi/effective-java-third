# readObject 메서드는 방어적으로 작성하라

* readObject 메서드는 인수가 유효한지 검사해야 하고 필요하다면 매개변수를 방어적으로 복사해야 한다.
  * 이 작업을 제대로 수행하지 않는다면 공격자가 쉽게 불변식을 깨뜨릴 수 있다.
* 객체를 역직렬화할 때는 클라이언트가 소유해서는 안 되는 객체 참조를 갖는 필드를 모두 반드시 방어적으로 복사해야 한다.
  * readObject 에서는 불변 클래스 안의 모든 private 가변 요소를 방어적으로 복사해야 한다.
* 방어적 복사를 유효성 검사보다 앞서 수행한다.

### readObject 메서드를 써도 좋을지 판단하는 방법
1. transient 필드를 제외한 모든 필드의 값을 매개변수로 받아 유효성 검사없이 필드에 대입하는 public 생성자를 추가해도 괜찮은가?
   에 대한 답이 아니오라면 커스텀 readObject 메서드를 만들어 모든 유효성 검사와 방어적 복사를 해야한다.
2. 직렬화 프록시 패턴을 사용한다.

### 정리
1. private 이어야 하는 객체 참조 필드는 각 필드가 가리키는 객체를 방어적으로 복사하라.
2. 방어적 복사 다음에는 반드시 불변식 검사가 나와야 한다.
3. 역직렬화 후 객체 그래프 전체의 유효성을 검사해야 한다면 ObjectInputValidation 인터페이스를 사용하라.
4. 직접적이든 간접적이든, 재정의할 수 있는 메서드는 호출하지 말자.